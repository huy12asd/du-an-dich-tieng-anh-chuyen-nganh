<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>T·ª´ v·ª±ng Module {{ module_id }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #f5f7fa;
            font-family: "Segoe UI", "Inter", sans-serif;
            color: #1e293b;
            line-height: 1.7;
        }

        h3 {
            text-align: left;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0;
        }

        .top-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.8rem;
        }

        .btn-group-custom {
            display: flex;
            gap: 10px;
        }

        .btn-dict, .btn-translate {
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-dict {
            background: #2563eb;
            color: #fff;
        }

        .btn-dict:hover {
            background: #1e40af;
            color: #fff;
        }

        .btn-translate {
            background: #10b981;
            color: #fff;
        }

        .btn-translate:hover {
            background: #059669;
            color: #fff;
        }

        .dictionary-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            padding: 2rem;
        }

        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }

        th {
            background: #f1f5f9;
            text-align: center;
            font-weight: 600;
            color: #0f172a;
            padding: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            vertical-align: top;
            padding: 16px 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:last-child td {
            border-bottom: none;
        }

        td:nth-child(1) {
            text-align: center;
            color: #475569;
            font-weight: 500;
        }

        td:nth-child(2) {
            font-weight: 700;
            color: #0f172a;
            font-size: 1.05em;
        }

        td:nth-child(3) {
            font-style: italic;
            color: #334155;
            width: 15%;
        }

        td:nth-child(4), td:nth-child(5) {
            color: #475569;
            font-size: 0.95em;
        }

        td:nth-child(5) i {
            color: #0d9488;
        }

        td:nth-child(6) {
            color: #64748b;
            font-size: 0.9em;
        }

        tr:hover {
            background: #f9fafb;
            transition: background 0.2s ease-in-out;
        }

        .pagination {
            margin-top: 2rem;
        }

        .page-link {
            color: #0f172a;
            border: none;
            border-radius: 8px;
            font-weight: 500;
        }

        .page-item.active .page-link {
            background-color: #2563eb;
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
        }

        .back-link {
            display: inline-block;
            text-decoration: none;
            color: #2563eb;
            font-weight: 500;
            margin-top: 1.5rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }
        
        .search-box {
            max-width: 600px;
            margin: 0 auto 1.5rem auto;
        }

        @media (max-width: 768px) {
            .dictionary-card {
                padding: 1rem;
            }

            th, td {
                font-size: 0.9em;
            }

            .top-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body class="container py-4">

    <div class="top-actions">
        <h3>T·ª´ v·ª±ng Module {{ module_id }}</h3>
        <div class="btn-group-custom">
            <a href="{{ url_for('modules') }}" class="btn-dict">üìò Danh s√°ch module</a>
            <a href="{{ url_for('index') }}" class="btn-translate">üåê D·ªãch vƒÉn b·∫£n</a>
        </div>
    </div>
    
    <!-- ‚úÖ ƒê√É S·ª¨A: class_ -> class -->
    <form class="search-box" method="POST" action="{{ url_for('terms', module_id=module_id) }}">
        <div class="input-group shadow-sm">
            <input type="text" 
                   class="form-control" 
                   name="term"
                   id="search-term"
                   placeholder="T√¨m trong module {{ module_id }}..." 
                   value="{{ query or '' }}"
                   list="suggestions-list"
                   autocomplete="off">
            <datalist id="suggestions-list"></datalist>
            <button class="btn btn-primary" type="submit">üîç T√¨m</button>
        </div>
    </form>

    <div class="dictionary-card">
        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Thu·∫≠t ng·ªØ</th>
                        <th>D·ªãch nghƒ©a</th>
                        <th>Ghi ch√∫</th>
                        <th>V√≠ d·ª•</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in terms %}
                    <tr>
                        <td>{{ loop.index + (page-1)*10 }}</td> 
                        <td>{{ t[1] }}</td>
                        <td>{{ t[2] }}</td>
                        <td>{{ t[3] or "" }}</td>
                        <td><i>{{ t[4] or "-" }}</i></td>  <!-- ‚úÖ S·ª≠a l·∫°i tr√°nh l·ªói t[5] -->
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">Kh√¥ng t√¨m th·∫•y thu·∫≠t ng·ªØ n√†o.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if not query and total_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('terms', module_id=module_id, page=page-1) }}">¬´ Tr∆∞·ªõc</a>
            </li>
            
            {% for p in range(1, total_pages + 1) %}
                <li class="page-item {% if p == page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('terms', module_id=module_id, page=p) }}">{{ p }}</a>
                </li>
            {% endfor %}
            
            <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('terms', module_id=module_id, page=page+1) }}">Sau ¬ª</a>
            </li>
        </ul>
    </nav>
    {% endif %}
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-term');
        const suggestionsList = document.getElementById('suggestions-list');
        const currentModuleId = {{ module_id|tojson }};

        if(searchInput) {
            searchInput.addEventListener('input', async function(e) {
                const query = e.target.value;
                
                if (query.length < 1) {
                    suggestionsList.innerHTML = '';
                    return;
                }
                
                try {
                    const response = await fetch(`/api/suggestions?q=${encodeURIComponent(query)}&module_id=${currentModuleId}`);
                    if (!response.ok) return;

                    const suggestions = await response.json();
                    suggestionsList.innerHTML = ''; 
                    
                    suggestions.forEach(term => {
                        const option = document.createElement('option');
                        option.value = term;
                        suggestionsList.appendChild(option);
                    });
                } catch (error) {
                    console.error("L·ªói khi l·∫•y g·ª£i √Ω:", error);
                }
            });
        }
    });
    </script>

</body>
</html>
